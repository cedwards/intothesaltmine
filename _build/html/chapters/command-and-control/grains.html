

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Grains &mdash; Into The Salt Mine</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
        <link rel="copyright" title="Copyright" href="../../copyright.html"/>
    <link rel="top" title="Into The Salt Mine" href="../../index.html"/>
        <link rel="up" title="Command &amp; Control" href="index.html"/>
        <link rel="next" title="Pillar" href="pillar.html"/>
        <link rel="prev" title="Key Management" href="key-management.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="fa fa-home"> Into The Salt Mine</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../preface/index.html">Preface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../preface/who-should-read-this-book.html">Who Should Read This Book</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preface/why-i-wrote-this-book.html">Why I Wrote This Book</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preface/navigating-this-book.html">Navigating This Book</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preface/online-resources.html">Online Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preface/conventions-used-in-this-book.html">Conventions Used In This Book</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preface/using-code-examples.html">Using Code Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preface/how-to-contact-me.html">How To Contact Me</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preface/acknowledgments.html">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preface/introduction.html">Introduction</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Chapters</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Command &amp; Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../events-and-reactions/index.html">Events &amp; Reactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../job-management/index.html">Job Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../web-interface-and-API/index.html">Web Interface &amp; API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduling-tasks/index.html">Scheduling Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../provisioning/index.html">Provisioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../salt-at-scale/index.html">Salt at Scale</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration-options/index.html">Configuration Options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../about-the-author.html">About The Author</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Into The Salt Mine</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Chapters</a> &raquo;</li>
      
          <li><a href="index.html">Command &amp; Control</a> &raquo;</li>
      
    <li>Grains</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="grains">
<h1>Grains<a class="headerlink" href="#grains" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Salt includes a built-in mechanism for determining static information about a
system. These bits of information are referred to as <em>grains</em> within the Salt
vocabulary. You might think of it as &#8220;little <em>grains</em> of information&#8221; about a
machine. These <em>grains</em> of information include hardware and networking
information, operating system details, and much more. These <em>grains</em> are also
expandable to include other bits of static information that you&#8217;d like to have
assigned to a machine. In this chapter we&#8217;ll explore the <em>grains</em> subsystem and
learn how to leverage this data within our Salt infrastructure.</p>
</div>
<div class="section" id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h2>
<p>Once you&#8217;ve completed this chapter you should have an improved understanding of
what grains are, how grains are queried, defined and synced. You should also understand the
order of grain definition precedence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you&#8217;re not yet familiar with the <em>grains</em> system it is important to
study this entire chapter. Upcoming chapters will make extensive use of
the information outlined here.</p>
</div>
</div>
<div class="section" id="standard-grains">
<h2>Standard Grains<a class="headerlink" href="#standard-grains" title="Permalink to this headline">¶</a></h2>
<p>Salt includes a set of &#8220;core grains&#8221; that should be available on any system.
These grains should be detected properly on every supported operating system
and distribution. In this section I&#8217;ll outline many of these core grains.</p>
<p>The list below defines the full set of core grains found on a CentOS Linux
system. As you can see, these are just the keys without values, but it gives
you an idea of what type of information is stored in grains.</p>
<blockquote>
<div><ul class="simple">
<li>SSDs</li>
<li>biosreleasedate</li>
<li>biosversion</li>
<li>cpu_flags</li>
<li>cpu_model</li>
<li>cpuarch</li>
<li>domain</li>
<li>fqdn</li>
<li>fqdn_ip4</li>
<li>fqdn_ip6</li>
<li>gpus</li>
<li>host</li>
<li>hwaddr_interfaces</li>
<li>id</li>
<li>ip4_interfaces</li>
<li>ip6_interfaces</li>
<li>ip_interfaces</li>
<li>ipv4</li>
<li>ipv6</li>
<li>kernel</li>
<li>kernelrelease</li>
<li>locale_info</li>
<li>localhost</li>
<li>lsb_distrib_codename</li>
<li>lsb_distrib_id</li>
<li>lsb_distrib_release</li>
<li>machine_id</li>
<li>manufacturer</li>
<li>master</li>
<li>mem_total</li>
<li>nodename</li>
<li>num_cpus</li>
<li>num_gpus</li>
<li>os</li>
<li>os_family</li>
<li>osarch</li>
<li>oscodename</li>
<li>osfinger</li>
<li>osfullname</li>
<li>osmajorrelease</li>
<li>osrelease</li>
<li>osrelease_info</li>
<li>path</li>
<li>productname</li>
<li>ps</li>
<li>pythonexecutable</li>
<li>pythonpath</li>
<li>pythonversion</li>
<li>saltpath</li>
<li>saltversion</li>
<li>saltversioninfo</li>
<li>selinux</li>
<li>serialnumber</li>
<li>server_id</li>
<li>shell</li>
<li>virtual</li>
<li>zmqversion</li>
</ul>
</div></blockquote>
<p>As you can see, there are over fifty items defined for each system within your
Salt infrastructure. These items will be used in upcoming chapters to
demonstrate the flexibility of making your minion management more dynamic.</p>
<p>Let&#8217;s look at what some of these values store.</p>
</div>
<div class="section" id="listing-grains">
<h2>Listing Grains<a class="headerlink" href="#listing-grains" title="Permalink to this headline">¶</a></h2>
<p>As you saw in the previous examples, there are a few different ways to query
for grains. Primarily you&#8217;ll use the <tt class="docutils literal"><span class="pre">grains</span></tt> module and query for one, all
or specific grain values. If you know the name of the grain you&#8217;re looking for
you can query for that directly:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>root@minion ~<span class="o">]</span><span class="c"># salt &#39;*&#39; grains.item fqdn</span>
alpha:
----------
fqdn:
    alpha.domain.tld
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>root@minion ~<span class="o">]</span><span class="c"># salt &#39;*&#39; grains.item kernelrelease</span>
alpha:
----------
kernelrelease:
    2.6.32-431.29.2.el6.x86_64
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>root@minion ~<span class="o">]</span><span class="c"># salt &#39;*&#39; grains.item mem_total</span>
alpha:
----------
mem_total:
    7872
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>root@minion ~<span class="o">]</span><span class="c"># salt &#39;*&#39; grains.item cpuarch</span>
alpha:
----------
cpuarch:
    x86_64
</pre></div>
</div>
</div>
<div class="section" id="defining-grains">
<h2>Defining Grains<a class="headerlink" href="#defining-grains" title="Permalink to this headline">¶</a></h2>
<p>Beyond the &#8220;core grains&#8221; that are defined on every system, it is possible to
define custom grains. These custom grains can be used to define additional
attributes about your systems. Examples of this might be <em>datacenter</em>, <em>rack</em>,
<em>cabinet</em>, or other internal or deployment-specific information. Grains are
defined on a per-minion basis and append to the existing grains.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">For more information about custom grains replacing existing grains, see the
next section <strong>Precedence</strong>.</p>
</div>
<p>Custom grains can be defined in a couple of places. Again, because grains are
unique per minion, custom grains are defined on a per-minion basis in one of
two places:</p>
<blockquote>
<div><ul class="simple">
<li>/etc/salt/minion</li>
<li>/etc/salt/grains</li>
</ul>
</div></blockquote>
<p>There is a slight difference in the way custom grains are imported depending on
the location. First we&#8217;ll outline the <tt class="docutils literal"><span class="pre">/etc/salt/minion</span></tt> method, followed by
<tt class="docutils literal"><span class="pre">/etc/salt/grains</span></tt>.</p>
<p><strong>/etc/salt/minion</strong></p>
<p>Custom grains can be added directly to the minion config file, or included as a
new file in the <tt class="docutils literal"><span class="pre">/etc/salt/minion.d/</span></tt> directory. If custom grains are added
to either of these locations the whole structure needs to be prefixed with the
<tt class="docutils literal"><span class="pre">grains</span></tt> configuration option. See the example below:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">grains</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">datacenter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">va5</span>
  <span class="l-Scalar-Plain">rack</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">17</span>
  <span class="l-Scalar-Plain">cabinet</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">3</span>
  <span class="l-Scalar-Plain">role</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">webserver</span>
</pre></div>
</div>
<p>As you can see, custom grains are the same simple key-value pairs that the core
grains are. These can be any arbitrary key-value pair that you want to define
for your systems. In addition to the key-value pairs, you can define other more
complex data structures such as lists or dictionaries. See the example below
for more complex custom grains.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">grains</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">role</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">webserver</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">memcache</span>
  <span class="l-Scalar-Plain">owners</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">tuttle</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ewoolley</span>
</pre></div>
</div>
<p><strong>/etc/salt/grains</strong></p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">role</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">webserver</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">memcache</span>
</pre></div>
</div>
</div>
<div class="section" id="precedence">
<h2>Precedence<a class="headerlink" href="#precedence" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="syncing-updating">
<h2>Syncing &amp; Updating<a class="headerlink" href="#syncing-updating" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pillar.html" class="btn btn-neutral float-right" title="Pillar"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="key-management.html" class="btn btn-neutral" title="Key Management"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; <a href="../../copyright.html">Copyright</a> 2014, Christer Edwards.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2014.12.11',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>